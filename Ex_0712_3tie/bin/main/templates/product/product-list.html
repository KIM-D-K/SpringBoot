<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<title>상품 목록</title>
<style>
	div {
		margin: 0 auto;
		width : 1000px;
	}
	
	table {
		width : 100%;
	}
	
	button{
		width:50%;
	}
</style>
</head>
<body>
	<div id="container">
	<table border="1">
		<tr>
			<th>단일 선택</th>
			<th>주문 개수</th>
			<th>상품 번호</th>
			<th>상품 이름</th>
			<th>상품 재고</th>
			<th>상품 가격</th>
			<th>등록 날짜</th>
			<th>수정 날짜</th>
		</tr>
		<th:block th:each="product : ${list}">
			<tr th:object="${product}">
				<td><input type="radio" name="productId" th:value="*{productId}"></td>
				<td><input type="text" class="productCount" readonly></td>
				<td th:text="*{productId}"></td>
				<td th:text="*{productName}"></td>
				<td th:text="*{productStock}"></td>
				<td th:text="*{productPrice}"></td>
				<td th:text="*{registerDate}"></td>
				<td th:text="*{updateDate}"></td>
		</th:block>
	</table>
	<button type="button" id="order-done">주문완료</button><button type="button" onclick="location.href='/order/list'">주문내역</button>
	</div>
	<form th:action="@{/order/done}" method="get" name="order-form">
		<input type="hidden" name="productId">
		<input type="hidden" name="productCount">
	</form>
</body>
<script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
<script>
	const $radios = $("input[type='radio']") //input태그중 type속성이 radio인 모든 요소 선택
	const $inputs = $("input[class='productCount']")//input태그중 class속성이 productCount인 모든 요소를 선택
	const $done = $("#order-done"); //id값이 order-done인 요소 선택
	const $form = $("form[name='order-form']")//name속성이 order-form인 form태그 선택
	
	let $temp, i; //temp는 임시로 저장할 변수, i는 선택된 라디오버튼의 인덱스를 저장
	
	 $radios.on("click", function(){ //라디오버튼의 클릭 이벤트 처리하는 함수
	       i = $radios.index(this); //i에 선택한 라디오 버튼의 index값을 저장
	       if($temp) {
	           $temp.prop("readOnly", true);
		//변수를 사용하여 이전에 선택된 입력 필드를 확인하고, readOnly 속성을 true로 설정하여 읽기 전용으로 변경합니다.
	           $temp.val(""); 
	       }
	       $inputs.eq(i).prop("readOnly", false);
		//클릭된 라디오 버튼에 해당하는 입력 필드를 선택하고, readOnly 속성을 false로 설정하여 편집 가능한 상태로 변경합니다.
	       $temp = $inputs.eq(i); //$temp 변수에 선택된 입력 필드를 저장합니다.
	    });
	
		//주문완료 버튼을 눌렀을 때 productId와 productCount값을 input태그에 전달
		$done.on("click",function(){
			if(i+1){
				$form.find("input[name='productId']").val($radios.eq(i).val());
				//form태그에서 name값이 productId인 input태그를 찾아서, 선택된 라디오버튼의 value값을 넣는다.
				$form.find("input[name='productCount']").val($inputs.eq(i).val());
				//form태그에서 name값이 productCount인 input태그를 찾아서, 작성된 input태그의 value값을 대입한다.
				console.log("상품번호 : " + $form.find("input[name='productId']").val());
				console.log("주문개수 : " + $form.find("input[name='productCount']").val());
				$form.submit();
			}
		})
	
</script>
</html>









